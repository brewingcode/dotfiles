#!/usr/bin/env python

# basic wrapper around Steam Web API (https://developer.valvesoftware.com/wiki/Steam_Web_API)
#   1. STEAMKEY: web api key https://steamcommunity.com/dev/apikey
#   2. STEAMID: (for some calls): a steam user ID

import sys
import os
import HTMLCache

def req(api, params):
    steamkey = os.environ['STEAMKEY']
    url = 'https://api.steampowered.com/{}/?key={}&format=json&{}'.format(api, steamkey, params)
    print HTMLCache.fetch(url)

cmd = sys.argv[1]
if cmd == 'games':
    steamid = os.environ['STEAMID']
    req('IPlayerService/GetOwnedGames/v00001', 'steamid={}'.format(steamid))
elif cmd == 'game':
    req('ISteamUserStats/GetSchemaForGame/v2', 'appid={}'.format(sys.argv[2]))
else:
    sys.stderr.write('unknown command: {}'.format(cmd))
    sys.exit(1)
