#!/usr/bin/env perl

# takes a command line, and compares it's output (both stdout and stderr) 
# against the last time the command was run

use strict;
use warnings;
use Digest::MD5 qw/md5_hex/;

if (@ARGV != 1) {
  die "exactly one argument required: the command to run";
}

my $prev = '/tmp/'.md5_hex($ARGV[0].'prev');
my $cur  = '/tmp/'.md5_hex($ARGV[0].'cur');

system "$ARGV[0] >$cur 2>&1";

if (-e $prev) {
  system "diff $prev $cur";

  if ($? >> 8 != 0) {
    system "cat $cur";
  }
}

system "cp $cur $prev";
