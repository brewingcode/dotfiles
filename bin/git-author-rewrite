#!/bin/sh

[ -z "$OLD_EMAIL" ] && { echo "define OLD_EMAIL and re-run" >&2; exit 1; }
[ -z "$CORRECT_NAME" ] && { echo "define CORRECT_NAME and re-run" >&2; exit 2; }
[ -z "$CORRECT_EMAIL" ] && { echo "define CORRECT_EMAIL and re-run" >&2; exit 3; }

echo "correcting $OLD_EMAIL -> $CORRECT_NAME <$CORRECT_EMAIL>"
sleep 5

git filter-branch --env-filter '
if [ "$GIT_COMMITTER_EMAIL" = "$OLD_EMAIL" ]
then
    export GIT_COMMITTER_NAME="$CORRECT_NAME"
    export GIT_COMMITTER_EMAIL="$CORRECT_EMAIL"
fi
if [ "$GIT_AUTHOR_EMAIL" = "$OLD_EMAIL" ]
then
    export GIT_AUTHOR_NAME="$CORRECT_NAME"
    export GIT_AUTHOR_EMAIL="$CORRECT_EMAIL"
fi
' --tag-name-filter cat -- --branches --tags

